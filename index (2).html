<html_artifact>
<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>فروشگاه سرامیک و ظروف</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f4f4;
            color: #333;
            direction: rtl; /* Set default text direction to right-to-left */
        }
        .container {
            width: 100%;
            max-width: 600px; /* Constrain width for iframe display */
            margin: 20px auto;
            background-color: #fff;
            padding: 20px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            border-radius: 8px;
            box-sizing: border-box; /* Include padding in width */
            overflow-y: auto; /* Enable vertical scrolling */
            max-height: calc(100vh - 40px); /* Adjust max-height to fit within viewport */
        }
        h1, h2, h3 {
            color: #5a2e00;
            text-align: center;
        }
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }
        .header h1 {
            margin: 0;
            font-size: 24px;
        }
        .cart-summary {
            font-size: 16px;
            font-weight: bold;
        }
        .product-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .product-card {
            background-color: #fff;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }
        .product-card img {
            max-width: 100%;
            height: auto;
            border-radius: 4px;
            margin-bottom: 10px;
        }
        .product-card h3 {
            font-size: 18px;
            margin: 10px 0;
        }
        .product-card p {
            font-size: 16px;
            color: #666;
            margin-bottom: 15px;
        }
        .product-card button, .checkout-button, .back-button {
            background-color: #8b4513;
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s ease;
        }
        .product-card button:hover, .checkout-button:hover, .back-button:hover {
            background-color: #6a3a0d;
        }
        .cart-items {
            border-top: 1px solid #eee;
            padding-top: 20px;
            margin-top: 20px;
        }
        .cart-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px dashed #eee;
        }
        .cart-item:last-child {
            border-bottom: none;
        }
        .cart-item span {
            font-size: 15px;
        }
        .cart-item button {
            background-color: #dc3545;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 5px 10px;
            cursor: pointer;
            font-size: 14px;
        }
        .cart-item button:hover {
            background-color: #c82333;
        }
        .cart-total {
            font-size: 18px;
            font-weight: bold;
            text-align: left;
            margin-top: 15px;
            color: #5a2e00;
        }

        /* Checkout Page Specific Styles */
        #checkout-page {
            display: none; /* Hidden by default */
        }
        .checkout-form label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        .checkout-form input[type="text"],
        .checkout-form input[type="tel"],
        .checkout-form textarea {
            width: calc(100% - 22px);
            padding: 10px;
            margin-bottom: 15px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
            font-size: 16px;
        }
        .checkout-form button[type="submit"] {
            background-color: #28a745;
            padding: 12px 20px;
            font-size: 18px;
            border-radius: 5px;
        }
        .checkout-form button[type="submit"]:hover {
            background-color: #218838;
        }
        .checkout-summary-items {
            list-style: none;
            padding: 0;
            margin-bottom: 20px;
            border: 1px solid #eee;
            border-radius: 4px;
            background-color: #f9f9f9;
        }
        .checkout-summary-items li {
            padding: 10px;
            border-bottom: 1px dashed #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .checkout-summary-items li:last-child {
            border-bottom: none;
        }
        .navigation-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }
        .navigation-buttons button {
            flex: 1;
            margin: 0 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Product Page -->
        <div id="product-page">
            <div class="header">
                <h1>فروشگاه ما</h1>
                <div class="cart-summary">
                    سبد خرید: <span id="cart-item-count">0</span> کالا
                </div>
            </div>

            <section id="products">
                <h2>محصولات ما</h2>
                <div class="product-list">
                    <div class="product-card" data-id="101" data-name="سرامیک طرح سنگی" data-price="150000">
                        <img src="https://via.placeholder.com/150x150?text=Ceramic+Stone" alt="سرامیک طرح سنگی">
                        <h3>سرامیک طرح سنگی</h3>
                        <p>قیمت: 150,000 تومان</p>
                        <button class="add-to-cart">افزودن به سبد خرید</button>
                    </div>
                    <div class="product-card" data-id="102" data-name="ظروف چینی طرح گل" data-price="250000">
                        <img src="https://via.placeholder.com/150x150?text=Porcelain+Flower" alt="ظروف چینی طرح گل">
                        <h3>ظروف چینی طرح گل</h3>
                        <p>قیمت: 250,000 تومان</p>
                        <button class="add-to-cart">افزودن به سبد خرید</button>
                    </div>
                    <div class="product-card" data-id="103" data-name="کاشی لعاب دار" data-price="90000">
                        <img src="https://via.placeholder.com/150x150?text=Glazed+Tile" alt="کاشی لعاب دار">
                        <h3>کاشی لعاب دار</h3>
                        <p>قیمت: 90,000 تومان</p>
                        <button class="add-to-cart">افزودن به سبد خرید</button>
                    </div>
                    <div class="product-card" data-id="104" data-name="ست ظروف سفالی" data-price="180000">
                        <img src="https://via.placeholder.com/150x150?text=Pottery+Set" alt="ست ظروف سفالی">
                        <h3>ست ظروف سفالی</h3>
                        <p>قیمت: 180,000 تومان</p>
                        <button class="add-to-cart">افزودن به سبد خرید</button>
                    </div>
                </div>
            </section>

            <section id="cart-display">
                <h2>سبد خرید شما</h2>
                <div class="cart-items" id="current-cart-items">
                    <!-- Cart items will be loaded here by JavaScript -->
                    <p id="empty-cart-message">سبد خرید شما خالی است.</p>
                </div>
                <div class="cart-total">
                    جمع کل: <span id="cart-total-display">0</span> تومان
                </div>
            </section>

            <div class="navigation-buttons">
                <button class="checkout-button" onclick="showCheckoutPage()">تکمیل سفارش</button>
            </div>
        </div>

        <!-- Checkout Page -->
        <div id="checkout-page">
            <h2>تکمیل اطلاعات و پرداخت</h2>
            <div class="checkout-summary-section">
                <h3>جزئیات سبد خرید شما</h3>
                <ul class="checkout-summary-items" id="checkout-cart-items">
                    <!-- Cart items for checkout will be loaded here -->
                </ul>
                <div class="cart-total">
                    جمع کل: <span id="checkout-cart-total-display">0</span> تومان
                </div>
            </div>

            <form id="checkout-form" class="checkout-form">
                <h3>اطلاعات مشتری</h3>
                <label for="first-name">نام:</label>
                <input type="text" id="first-name" name="firstName" required>

                <label for="last-name">نام خانوادگی:</label>
                <input type="text" id="last-name" name="lastName" required>

                <label for="phone-number">شماره همراه:</label>
                <input type="tel" id="phone-number" name="phone" required pattern="09[0-9]{9}">
                <small>فرمت: 09123456789</small>

                <label for="province">استان:</label>
                <input type="text" id="province" name="province" required>

                <label for="city">شهر:</label>
                <input type="text" id="city" name="city" required>

                <label for="address">آدرس دقیق:</label>
                <textarea id="address" name="address" rows="4" required></textarea>

                <label for="postal-code">کد پستی:</label>
                <input type="text" id="postal-code" name="postalCode" required pattern="[0-9]{10}">
                <small>کد پستی ۱۰ رقمی</small>

                <label for="custom-design">توضیحات طراحی سفارشی (اختیاری):</label>
                <textarea id="custom-design" name="customDesign" rows="3"></textarea>

                <div class="navigation-buttons">
                    <button type="button" class="back-button" onclick="showProductPage()">بازگشت به فروشگاه</button>
                    <button type="submit">ثبت سفارش</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Load cart data from localStorage on page load
            loadCart();
            // Attach event listeners for "Add to Cart" buttons
            attachAddToCartListeners();
            // Attach submit event listener for the checkout form
            document.getElementById('checkout-form').addEventListener('submit', submitOrder);
        });

        function attachAddToCartListeners() {
            document.querySelectorAll('.add-to-cart').forEach(button => {
                button.addEventListener('click', (event) => {
                    const productCard = event.target.closest('.product-card');
                    if (productCard) {
                        const productId = productCard.dataset.id;
                        const productName = productCard.dataset.name;
                        const productPrice = parseFloat(productCard.dataset.price); // Ensure price is a number

                        console.log('--- Debug: Add to Cart Clicked ---');
                        console.log('Product ID:', productId);
                        console.log('Product Name:', productName);
                        console.log('Product Price (raw):', productCard.dataset.price);
                        console.log('Product Price (parsed):', productPrice);

                        if (isNaN(productPrice)) {
                            console.error('Error: Product price is not a valid number for product:', productName);
                            alert('خطا در قیمت محصول. لطفا با مدیر سایت تماس بگیرید.');
                            return;
                        }

                        addToCart(productId, productName, productPrice);
                    }
                });
            });
        }

        // Function to add a product to the cart
        function addToCart(productId, productName, productPrice) {
            let cart = JSON.parse(localStorage.getItem('cart')) || [];
            console.log('Cart before add:', cart);

            const existingItem = cart.find(item => item.id === productId);

            if (existingItem) {
                existingItem.quantity = (existingItem.quantity || 1) + 1;
            } else {
                cart.push({ id: productId, name: productName, price: productPrice, quantity: 1 });
            }

            localStorage.setItem('cart', JSON.stringify(cart));
            console.log('Cart after add (stored in localStorage):', cart);
            updateCartDisplay(); // Update the cart display on the product page
        }

        // Function to remove a product from the cart
        function removeFromCart(productId) {
            let cart = JSON.parse(localStorage.getItem('cart')) || [];
            cart = cart.filter(item => item.id !== productId);
            localStorage.setItem('cart', JSON.stringify(cart));
            updateCartDisplay();
            loadCheckoutCart(); // Also update checkout cart if on that page
        }

        // Function to calculate the total price of items in the cart
        function calculateCartTotal(cart) {
            return cart.reduce((total, item) => {
                const itemPrice = parseFloat(item.price);
                const itemQuantity = parseInt(item.quantity || 1); // Default to 1 if quantity is not set
                if (isNaN(itemPrice) || isNaN(itemQuantity)) {
                    console.error('Invalid price or quantity for item:', item);
                    return total; // Skip this item if invalid
                }
                return total + (itemPrice * itemQuantity);
            }, 0);
        }

        // Function to update the cart display on the product page
        function updateCartDisplay() {
            const cart = JSON.parse(localStorage.getItem('cart')) || [];
            const cartItemsContainer = document.getElementById('current-cart-items');
            const cartTotalDisplay = document.getElementById('cart-total-display');
            const cartItemCount = document.getElementById('cart-item-count');
            const emptyCartMessage = document.getElementById('empty-cart-message');

            cartItemsContainer.innerHTML = ''; // Clear previous items

            if (cart.length === 0) {
                emptyCartMessage.style.display = 'block';
            } else {
                emptyCartMessage.style.display = 'none';
                cart.forEach(item => {
                    const cartItemDiv = document.createElement('div');
                    cartItemDiv.classList.add('cart-item');
                    cartItemDiv.innerHTML = `
                        <span>${item.name} (x${item.quantity})</span>
                        <span>${item.price.toLocaleString()} تومان</span>
                        <button onclick="removeFromCart('${item.id}')">حذف</button>
                    `;
                    cartItemsContainer.appendChild(cartItemDiv);
                });
            }

            const total = calculateCartTotal(cart);
            cartTotalDisplay.textContent = total.toLocaleString();
            cartItemCount.textContent = cart.length;
        }

        // Function to load cart for the product page (initial load)
        function loadCart() {
            updateCartDisplay();
        }

        // Function to show the checkout page and hide the product page
        function showCheckoutPage() {
            document.getElementById('product-page').style.display = 'none';
            document.getElementById('checkout-page').style.display = 'block';
            loadCheckoutCart(); // Load cart items specifically for the checkout page
        }

        // Function to show the product page and hide the checkout page
        function showProductPage() {
            document.getElementById('checkout-page').style.display = 'none';
            document.getElementById('product-page').style.display = 'block';
            loadCart(); // Reload cart display for product page
        }

        // Function to load and display cart items on the checkout page
        function loadCheckoutCart() {
            const cart = JSON.parse(localStorage.getItem('cart')) || [];
            const checkoutCartItemsContainer = document.getElementById('checkout-cart-items');
            const checkoutCartTotalDisplay = document.getElementById('checkout-cart-total-display');

            checkoutCartItemsContainer.innerHTML = ''; // Clear previous items

            if (cart.length === 0) {
                checkoutCartItemsContainer.innerHTML = '<li>سبد خرید شما خالی است.</li>';
            } else {
                cart.forEach(item => {
                    const listItem = document.createElement('li');
                    listItem.innerHTML = `
                        <span>${item.name} (x${item.quantity})</span>
                        <span>${(item.price * item.quantity).toLocaleString()} تومان</span>
                    `;
                    checkoutCartItemsContainer.appendChild(listItem);
                });
            }

            const total = calculateCartTotal(cart);
            checkoutCartTotalDisplay.textContent = total.toLocaleString();
        }

        // Function to submit the order and save data to localStorage
        function submitOrder(event) {
            event.preventDefault(); // Prevent default form submission

            const customerInfo = {
                firstName: document.getElementById('first-name').value,
                lastName: document.getElementById('last-name').value,
                phone: document.getElementById('phone-number').value,
                province: document.getElementById('province').value,
                city: document.getElementById('city').value,
                address: document.getElementById('address').value,
                postalCode: document.getElementById('postal-code').value,
                customDesign: document.getElementById('custom-design').value
            };

            const currentCart = JSON.parse(localStorage.getItem('cart')) || [];
            if (currentCart.length === 0) {
                alert('سبد خرید شما خالی است. لطفا محصولی را به سبد خرید اضافه کنید.');
                return;
            }

            const cartTotal = calculateCartTotal(currentCart);

            const timestamp = new Date().toISOString();
            const folderId = `order_${Date.now()}`; // Unique ID for this order

            const orderDetails = {
                folderId: folderId,
                timestamp: timestamp,
                customerInfo: customerInfo,
                cartItems: currentCart,
                totalAmount: cartTotal
            };

            // Store the individual order details under its unique ID (virtual folder)
            localStorage.setItem(`folder_${folderId}`, JSON.stringify(orderDetails));

            // Update the master list of all user folders/orders
            let allUserFolders = JSON.parse(localStorage.getItem('allUserFolders')) || [];
            allUserFolders.push({
                folderId: folderId,
                timestamp: timestamp,
                firstName: customerInfo.firstName,
                lastName: customerInfo.lastName
            });
            localStorage.setItem('allUserFolders', JSON.stringify(allUserFolders));

            // --- Display in Console for Debugging ---
            console.log('--- Order Submitted ---');
            console.log('Customer Info:', customerInfo);
            console.log('Cart Items:', currentCart);
            console.log('Total Amount:', cartTotal);
            console.log('Order Details stored under key:', `folder_${folderId}`, orderDetails);
            console.log('All Orders List (allUserFolders):', allUserFolders);
            console.log('--- End of Order ---');
            // --- End Display in Console ---


            // Clear the cart after successful submission
            localStorage.removeItem('cart');
            updateCartDisplay(); // Update display for product page (will show empty cart)
            loadCheckoutCart(); // Update display for checkout page (will be empty)

            alert('سفارش شما با موفقیت ثبت شد و اطلاعات در کنسول و LocalStorage ذخیره گردید!');
            document.getElementById('checkout-form').reset(); // Clear form fields
            showProductPage(); // Go back to product page after submission
        }
    </script>
</body>
</html>
</html_artifact>